<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI‰æõÂ∫îÂïÜÁÆ°ÁêÜ - ÂìàÂü∫Á±≥</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <link rel="stylesheet" href="/static/css/table.css">
    <link rel="stylesheet" href="/static/css/vendor/element-plus.css">
    <script src="/static/js/vue.global.prod.js"></script>
    <script src="/static/js/element-plus.js"></script>
    <script src="/static/js/navbar.js"></script>
    <style id="navbar-styles"></style>
    <script>
        document.getElementById('navbar-styles').textContent = navbarStyles;
    </script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        #app {
            min-height: 100vh;
        }

        .main-container {
            padding: 24px;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* È°µÈù¢Â§¥ÈÉ® */
        .page-header {
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .page-icon {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            backdrop-filter: blur(10px);
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .page-subtitle {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 4px;
        }

        /* ÁªüËÆ°Âç°Áâá */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card-mini {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .stat-card-mini:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
        }

        .stat-card-mini .label {
            font-size: 13px;
            color: #909399;
            margin-bottom: 8px;
        }

        .stat-card-mini .value {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ‰∏ªÂÜÖÂÆπÂå∫ */
        .content-card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        /* Â∑•ÂÖ∑Ê†è */
        .toolbar {
            padding: 20px 24px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fafbfc;
        }

        .toolbar-left {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .search-box {
            width: 280px;
        }

        /* Ë°®Ê†ºÊ†∑ÂºèÂ¢ûÂº∫ */
        .provider-name-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .provider-avatar {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 700;
            font-size: 14px;
        }

        .provider-info {
            flex: 1;
        }

        .provider-name-text {
            font-weight: 600;
            color: #303133;
            font-size: 14px;
        }

        .provider-meta {
            font-size: 12px;
            color: #909399;
            margin-top: 2px;
        }

        /* Á±ªÂûãÊ†áÁ≠æ */
        .type-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .type-badge.gemini {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            color: #2e7d32;
        }

        .type-badge.openai {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            color: #1565c0;
        }

        /* ÂÖ≥ÈîÆÂ≠óÂØπËØùÊ°Ü */
        .keywords-dialog {
            padding: 8px;
        }

        .keywords-section {
            margin-bottom: 20px;
        }

        .keywords-section:last-child {
            margin-bottom: 0;
        }

        .keywords-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f0f0f0;
        }

        .keywords-header-icon {
            font-size: 18px;
        }

        .keywords-header-title {
            font-size: 15px;
            font-weight: 600;
            color: #303133;
        }

        .keywords-header-badge {
            margin-left: auto;
            padding: 2px 8px;
            background: #f0f2f5;
            border-radius: 10px;
            font-size: 11px;
            color: #606266;
        }

        .keywords-content {
            background: #fafbfc;
            border-radius: 8px;
            padding: 16px;
            min-height: 80px;
            max-height: 300px;
            overflow-y: auto;
        }

        .keywords-content::-webkit-scrollbar {
            width: 6px;
        }

        .keywords-content::-webkit-scrollbar-thumb {
            background: #d0d0d0;
            border-radius: 3px;
        }

        .keyword-tag {
            display: inline-block;
            padding: 6px 12px;
            margin: 4px;
            border-radius: 6px;
            font-size: 12px;
            font-family: 'Courier New', Monaco, monospace;
            transition: all 0.2s;
        }

        .keyword-tag:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .keyword-tag.preset {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            color: #1565c0;
            border: 1px solid #90caf9;
        }

        .keyword-tag.custom {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            color: #ef6c00;
            border: 1px solid #ffb74d;
        }

        .keywords-empty {
            text-align: center;
            padding: 32px;
            color: #909399;
            font-size: 13px;
        }

        .keywords-empty-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.3;
        }

        /* ÁºñËæëË°®Âçï‰ºòÂåñ */
        .form-section {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px dashed #e0e0e0;
        }

        .form-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .form-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #303133;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-section-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 12px;
        }

        /* Á©∫Áä∂ÊÄÅ‰ºòÂåñ */
        .elegant-empty {
            text-align: center;
            padding: 100px 40px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .elegant-empty-icon {
            font-size: 80px;
            color: #c0c4cc;
            margin-bottom: 24px;
        }

        .elegant-empty-title {
            font-size: 20px;
            font-weight: 600;
            color: #303133;
            margin-bottom: 12px;
        }

        .elegant-empty-desc {
            font-size: 14px;
            color: #909399;
            margin-bottom: 32px;
        }
    </style>
</head>
<body>
    <div id="app">
        <nav-bar active-page="providers"></nav-bar>

        <div class="main-container">
            <!-- È°µÈù¢Â§¥ÈÉ® -->
            <div class="page-header">
                <div class="page-title-group">
                    <div class="page-icon">ü§ñ</div>
                    <div>
                        <div class="page-title">AI ‰æõÂ∫îÂïÜÁÆ°ÁêÜ</div>
                        <div class="page-subtitle">ÈÖçÁΩÆÂíåÁÆ°ÁêÜ AI ÂØÜÈí•‰æõÂ∫îÂïÜ</div>
                    </div>
                </div>
                <el-button type="primary" size="large" @click="showAddDialog" style="border-radius: 8px;">
                    <el-icon><Plus /></el-icon>
                    <span style="margin-left: 8px;">Êñ∞Â¢û‰æõÂ∫îÂïÜ</span>
                </el-button>
            </div>

            <!-- ÁªüËÆ°Âç°Áâá -->
            <div class="stats-row">
                <div class="stat-card-mini">
                    <div class="label">‰æõÂ∫îÂïÜÊÄªÊï∞</div>
                    <div class="value">{{ providers.length }}</div>
                </div>
                <div class="stat-card-mini">
                    <div class="label">Gemini Á±ªÂûã</div>
                    <div class="value">{{ providers.filter(p => p.type === 'gemini').length }}</div>
                </div>
                <div class="stat-card-mini">
                    <div class="label">OpenAI Á±ªÂûã</div>
                    <div class="value">{{ providers.filter(p => p.type === 'openai_style').length }}</div>
                </div>
                <div class="stat-card-mini">
                    <div class="label">Ëá™ÂÆö‰πâÂÖ≥ÈîÆÂ≠ó</div>
                    <div class="value">{{ getTotalCustomKeywords() }}</div>
                </div>
            </div>

            <!-- Á©∫Áä∂ÊÄÅ -->
            <div v-if="!loading && providers.length === 0" class="elegant-empty">
                <div class="elegant-empty-icon">ü§ñ</div>
                <div class="elegant-empty-title">ËøòÊ≤°ÊúâÈÖçÁΩÆ‰æõÂ∫îÂïÜ</div>
                <div class="elegant-empty-desc">ÁÇπÂáª‰∏äÊñπÊåâÈíÆÂºÄÂßãÊ∑ªÂä†‰Ω†ÁöÑÁ¨¨‰∏Ä‰∏™ AI ‰æõÂ∫îÂïÜÈÖçÁΩÆ</div>
                <el-button type="primary" size="large" @click="showAddDialog" style="border-radius: 8px;">
                    <el-icon><Plus /></el-icon>
                    <span style="margin-left: 8px;">Êñ∞Â¢ûÁ¨¨‰∏Ä‰∏™‰æõÂ∫îÂïÜ</span>
                </el-button>
            </div>

            <!-- ‰æõÂ∫îÂïÜÂàóË°® -->
            <div v-if="providers.length > 0" class="content-card">
                <div class="toolbar">
                    <div class="toolbar-left">
                        <el-input
                            v-model="searchText"
                            placeholder="ÊêúÁ¥¢‰æõÂ∫îÂïÜÂêçÁß∞..."
                            class="search-box"
                            clearable
                        >
                            <template #prefix>
                                <el-icon><Search /></el-icon>
                            </template>
                        </el-input>
                    </div>
                    <div>
                        <el-text type="info" size="small">ÂÖ± {{ filteredProviders.length }} ‰∏™‰æõÂ∫îÂïÜ</el-text>
                    </div>
                </div>

                <el-table :data="filteredProviders" v-loading="loading" style="width: 100%">
                    <el-table-column label="‰æõÂ∫îÂïÜ" width="280">
                        <template #default="{ row }">
                            <div class="provider-name-cell">
                                <div class="provider-avatar">{{ row.name.substring(0, 2).toUpperCase() }}</div>
                                <div class="provider-info">
                                    <div class="provider-name-text">{{ row.name }}</div>
                                    <div class="provider-meta">{{ row.check_model }}</div>
                                </div>
                            </div>
                        </template>
                    </el-table-column>

                    <el-table-column label="Á±ªÂûã" width="160">
                        <template #default="{ row }">
                            <div :class="['type-badge', row.type === 'gemini' ? 'gemini' : 'openai']">
                                <span v-if="row.type === 'gemini'">üîÆ</span>
                                <span v-else>ü§ñ</span>
                                {{ getProviderTypeLabel(row.type) }}
                            </div>
                        </template>
                    </el-table-column>

                    <el-table-column label="API ÈÖçÁΩÆ" min-width="200">
                        <template #default="{ row }">
                            <el-text size="small" type="info" v-if="row.type === 'gemini'">
                                {{ row.api_endpoint || '-' }}
                            </el-text>
                            <el-text size="small" type="info" v-if="row.type === 'openai_style'">
                                {{ row.api_base_url || '-' }}
                            </el-text>
                        </template>
                    </el-table-column>

                    <el-table-column label="GPT Load" width="140">
                        <template #default="{ row }">
                            <el-tag v-if="row.gpt_load_group_name" size="small" effect="plain">
                                {{ row.gpt_load_group_name }}
                            </el-tag>
                            <el-text v-else type="info" size="small">Êú™ÈÖçÁΩÆ</el-text>
                        </template>
                    </el-table-column>

                    <el-table-column label="ÂÖ≥ÈîÆÂ≠ó" width="100" align="center">
                        <template #default="{ row }">
                            <el-badge :value="(row.custom_keywords || []).length" :hidden="!row.custom_keywords || row.custom_keywords.length === 0">
                                <el-button size="small" text @click="viewKeywords(row)">
                                    <el-icon><View /></el-icon>
                                </el-button>
                            </el-badge>
                        </template>
                    </el-table-column>

                    <el-table-column label="Êìç‰Ωú" width="280" fixed="right">
                        <template #default="{ row, $index }">
                            <div class="table-actions">
                                <el-button size="small" @click="showEditDialog(row, $index)">
                                    <el-icon><Edit /></el-icon> ÁºñËæë
                                </el-button>
                                <el-button size="small" type="primary" @click="copyProvider(row)">
                                    <el-icon><CopyDocument /></el-icon> Â§çÂà∂
                                </el-button>
                                <el-button size="small" type="danger" @click="deleteProvider($index)">
                                    <el-icon><Delete /></el-icon> Âà†Èô§
                                </el-button>
                            </div>
                        </template>
                    </el-table-column>
                </el-table>
            </div>

            <!-- ÂÖ≥ÈîÆÂ≠óÊü•ÁúãÂØπËØùÊ°Ü -->
            <el-dialog
                v-model="keywordsDialogVisible"
                title="ÊêúÁ¥¢ÂÖ≥ÈîÆÂ≠óÈÖçÁΩÆ"
                width="800px"
                :close-on-click-modal="false"
            >
                <div class="keywords-dialog" v-if="selectedProvider">
                    <!-- È¢ÑËÆæÂÖ≥ÈîÆÂ≠ó -->
                    <div class="keywords-section">
                        <div class="keywords-header">
                            <span class="keywords-header-icon">üîç</span>
                            <span class="keywords-header-title">È¢ÑËÆæÂÖ≥ÈîÆÂ≠ó</span>
                            <span class="keywords-header-badge">Ëá™Âä®ÁîüÊàê ¬∑ Âè™ËØª</span>
                        </div>
                        <div class="keywords-content">
                            <div v-if="presetKeywords.length > 0">
                                <span v-for="(keyword, index) in presetKeywords" :key="index" class="keyword-tag preset">
                                    {{ keyword }}
                                </span>
                            </div>
                            <div v-else class="keywords-empty">
                                <div class="keywords-empty-icon">üì≠</div>
                                <div>ÊöÇÊó†È¢ÑËÆæÂÖ≥ÈîÆÂ≠ó</div>
                            </div>
                        </div>
                    </div>

                    <!-- Ëá™ÂÆö‰πâÂÖ≥ÈîÆÂ≠ó -->
                    <div class="keywords-section">
                        <div class="keywords-header">
                            <span class="keywords-header-icon">‚úèÔ∏è</span>
                            <span class="keywords-header-title">Ëá™ÂÆö‰πâÂÖ≥ÈîÆÂ≠ó</span>
                            <span class="keywords-header-badge">Áî®Êà∑ÈÖçÁΩÆ ¬∑ ÂèØÁºñËæë</span>
                        </div>
                        <div class="keywords-content">
                            <div v-if="selectedProvider.custom_keywords && selectedProvider.custom_keywords.length > 0">
                                <span v-for="(keyword, index) in selectedProvider.custom_keywords" :key="index" class="keyword-tag custom">
                                    {{ keyword }}
                                </span>
                            </div>
                            <div v-else class="keywords-empty">
                                <div class="keywords-empty-icon">üìù</div>
                                <div>ÊöÇÊó†Ëá™ÂÆö‰πâÂÖ≥ÈîÆÂ≠ó</div>
                                <div style="margin-top: 8px; font-size: 12px;">ÁÇπÂáª"ÁºñËæë"ÊåâÈíÆÊ∑ªÂä†Ëá™ÂÆö‰πâÂÖ≥ÈîÆÂ≠ó</div>
                            </div>
                        </div>
                    </div>

                    <el-alert type="info" :closable="false" style="margin-top: 16px;">
                        <template #title>
                            <div style="font-size: 13px; line-height: 1.6;">
                                <strong>ÂÖ≥ÈîÆÂ≠óËØ¥ÊòéÔºö</strong><br>
                                ‚Ä¢ È¢ÑËÆæÂÖ≥ÈîÆÂ≠óÊ†πÊçÆ‰æõÂ∫îÂïÜÁ±ªÂûãÂíåÂØÜÈí•Ê®°ÂºèËá™Âä®ÁîüÊàêÔºåÁî®‰∫éÂü∫Á°ÄÊêúÁ¥¢<br>
                                ‚Ä¢ Ëá™ÂÆö‰πâÂÖ≥ÈîÆÂ≠óÁî±Áî®Êà∑ÊâãÂä®Ê∑ªÂä†ÔºåÂú®È¢ÑËÆæÂÖ≥ÈîÆÂ≠ó‰πãÂêéÊêúÁ¥¢<br>
                                ‚Ä¢ ‰∏§ÁßçÂÖ≥ÈîÆÂ≠óÈÖçÂêà‰ΩøÁî®ÔºåÂèØ‰ª•ÊúÄÂ§ßÂåñÂØÜÈí•ÂèëÁé∞Áéá
                            </div>
                        </template>
                    </el-alert>
                </div>
            </el-dialog>

            <!-- Êñ∞Â¢û/ÁºñËæë‰æõÂ∫îÂïÜÂØπËØùÊ°Ü -->
            <el-dialog
                v-model="dialogVisible"
                :title="dialogMode === 'add' ? 'Êñ∞Â¢û‰æõÂ∫îÂïÜ' : 'ÁºñËæë‰æõÂ∫îÂïÜ'"
                width="750px"
                :close-on-click-modal="false"
                @close="resetDialog"
            >
                <el-form :model="currentProvider" label-width="140px">
                    <!-- Âü∫Á°Ä‰ø°ÊÅØ -->
                    <div class="form-section">
                        <div class="form-section-title">
                            <div class="form-section-icon">üìã</div>
                            <span>Âü∫Á°Ä‰ø°ÊÅØ</span>
                        </div>
                        <el-form-item label="‰æõÂ∫îÂïÜÂêçÁß∞" required>
                            <el-input v-model="currentProvider.name" placeholder="‰æãÂ¶Ç: gemini" />
                        </el-form-item>

                        <el-form-item label="‰æõÂ∫îÂïÜÁ±ªÂûã" required>
                            <el-select v-model="currentProvider.type" style="width: 100%;">
                                <el-option label="Google Gemini" value="gemini">
                                    <span>üîÆ Google Gemini</span>
                                </el-option>
                                <el-option label="OpenAI Compatible" value="openai_style">
                                    <span>ü§ñ OpenAI Compatible</span>
                                </el-option>
                            </el-select>
                        </el-form-item>

                        <el-form-item label="È™åËØÅÊ®°Âûã" required>
                            <el-input v-model="currentProvider.check_model" placeholder="‰æãÂ¶Ç: gemini-2.0-flash-exp" />
                        </el-form-item>
                    </div>

                    <!-- API ÈÖçÁΩÆ -->
                    <div class="form-section">
                        <div class="form-section-title">
                            <div class="form-section-icon">üîå</div>
                            <span>API ÈÖçÁΩÆ</span>
                        </div>
                        <el-form-item label="API Endpoint" v-if="currentProvider.type === 'gemini'">
                            <el-input v-model="currentProvider.api_endpoint" placeholder="generativelanguage.googleapis.com" />
                        </el-form-item>

                        <el-form-item label="API Base URL" v-if="currentProvider.type === 'openai_style'">
                            <el-input v-model="currentProvider.api_base_url" placeholder="https://api.openai.com/v1" />
                        </el-form-item>

                        <el-form-item label="ÂØÜÈí•Ê≠£ÂàôË°®ËææÂºè" required>
                            <el-input
                                :model-value="currentProvider.key_patterns && currentProvider.key_patterns[0] || ''"
                                @update:model-value="val => { if (!currentProvider.key_patterns) currentProvider.key_patterns = []; currentProvider.key_patterns[0] = val }"
                                placeholder="AIzaSy[A-Za-z0-9\\-_]{33}">
                                <template #append>
                                    <el-button @click="showPatternHelp">
                                        <el-icon><QuestionFilled /></el-icon>
                                    </el-button>
                                </template>
                            </el-input>
                            <div style="margin-top: 6px; font-size: 12px; color: #909399;">
                                Ê≥®ÊÑèÔºöÊ≠£ÂàôË°®ËææÂºè‰∏≠ÁöÑÂèçÊñúÊù†ÈúÄË¶ÅËΩ¨‰πâÔºàÁî®Âõõ‰∏™ÂèçÊñúÊù†Ôºâ
                            </div>
                        </el-form-item>
                    </div>

                    <!-- ÂêåÊ≠•ÈÖçÁΩÆ -->
                    <div class="form-section">
                        <div class="form-section-title">
                            <div class="form-section-icon">üîÑ</div>
                            <span>ÂêåÊ≠•ÈÖçÁΩÆ</span>
                        </div>
                        <el-form-item label="GPT Load ÂàÜÁªÑ">
                            <el-input v-model="currentProvider.gpt_load_group_name" placeholder="‰æãÂ¶Ç: gemini_daye" />
                            <div style="margin-top: 6px; font-size: 12px; color: #909399;">
                                ÈÖçÁΩÆÂêéÔºåÊúâÊïàÂØÜÈí•Â∞ÜËá™Âä®ÂêåÊ≠•Âà∞ÊåáÂÆöÁöÑ GPT Load ÂàÜÁªÑ
                            </div>
                        </el-form-item>

                        <el-form-item label="Ë∑≥Ëøá AI ÂàÜÊûê">
                            <el-switch v-model="currentProvider.skip_ai_analysis" />
                            <span style="margin-left: 12px; font-size: 13px; color: #909399;">
                                ÂêØÁî®ÂêéÔºåÂΩìÊâÄÊúâ‰æõÂ∫îÂïÜÈÉΩÊó†ÊïàÊó∂Ôºå‰∏ç‰ºöÂØπÊ≠§‰æõÂ∫îÂïÜ‰ΩøÁî® AI ÂàÜÊûêÊñá‰ª∂ÂÜÖÂÆπ
                            </span>
                        </el-form-item>
                    </div>

                    <!-- ÊêúÁ¥¢ÂÖ≥ÈîÆÂ≠ó -->
                    <div class="form-section">
                        <div class="form-section-title">
                            <div class="form-section-icon">üîç</div>
                            <span>Ëá™ÂÆö‰πâÊêúÁ¥¢ÂÖ≥ÈîÆÂ≠ó</span>
                        </div>
                        <el-form-item label="ÂÖ≥ÈîÆÂ≠óÂàóË°®">
                            <el-input
                                v-model="customKeywordsText"
                                type="textarea"
                                :rows="6"
                                placeholder="ÊØèË°å‰∏Ä‰∏™ÂÖ≥ÈîÆÂ≠ó&#10;&#10;‰æãÂ¶Ç:&#10;GEMINI_API_KEY&#10;GOOGLE_AI_KEY&#10;MY_CUSTOM_KEYWORD"
                            />
                            <div style="margin-top: 6px; font-size: 12px; color: #909399;">
                                üí° ÊØèË°åËæìÂÖ•‰∏Ä‰∏™Ëá™ÂÆö‰πâÂÖ≥ÈîÆÂ≠óÔºåÊêúÁ¥¢Êó∂‰ºöÂú®È¢ÑËÆæÂÖ≥ÈîÆÂ≠ó‰πãÂêé‰ΩøÁî®
                            </div>
                        </el-form-item>
                    </div>
                </el-form>

                <template #footer>
                    <el-button @click="dialogVisible = false" size="large">ÂèñÊ∂à</el-button>
                    <el-button type="primary" @click="saveProvider" size="large" style="border-radius: 8px;">
                        <el-icon><Check /></el-icon>
                        <span style="margin-left: 8px;">‰øùÂ≠ò</span>
                    </el-button>
                </template>
            </el-dialog>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        createApp({
            data() {
                return {
                    loading: false,
                    providers: [],
                    searchText: '',
                    dialogVisible: false,
                    keywordsDialogVisible: false,
                    dialogMode: 'add',
                    currentIndex: -1,
                    currentProvider: this.getEmptyProvider(),
                    selectedProvider: null,
                    presetKeywords: [],
                    customKeywordsText: ''
                };
            },
            computed: {
                filteredProviders() {
                    if (!this.searchText) return this.providers;
                    const search = this.searchText.toLowerCase();
                    return this.providers.filter(p =>
                        p.name.toLowerCase().includes(search) ||
                        p.type.toLowerCase().includes(search) ||
                        p.check_model.toLowerCase().includes(search)
                    );
                }
            },
            mounted() {
                this.checkAuth();
                this.loadProviders();
            },
            methods: {
                checkAuth() {
                    const token = localStorage.getItem('access_token');
                    if (!token) {
                        window.location.href = '/login';
                    }
                },
                getEmptyProvider() {
                    return {
                        name: '',
                        type: 'gemini',
                        check_model: '',
                        api_endpoint: 'generativelanguage.googleapis.com',
                        api_base_url: '',
                        key_patterns: [''],
                        gpt_load_group_name: '',
                        skip_ai_analysis: false,
                        custom_keywords: []
                    };
                },
                getTotalCustomKeywords() {
                    return this.providers.reduce((total, p) => {
                        return total + (p.custom_keywords ? p.custom_keywords.length : 0);
                    }, 0);
                },
                async loadProviders() {
                    this.loading = true;
                    try {
                        const token = localStorage.getItem('access_token');
                        const response = await fetch('/api/config/ai_providers', {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        if (response.ok) {
                            const data = await response.json();
                            this.providers = Array.isArray(data) ? data : [];
                            this.providers = this.providers.map(p => ({
                                ...p,
                                custom_keywords: p.custom_keywords || []
                            }));
                        } else if (response.status === 401) {
                            ElMessage.error('ËÆ§ËØÅÂ§±Ë¥•ÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï');
                            localStorage.removeItem('access_token');
                            window.location.href = '/login';
                        } else {
                            ElMessage.error('Âä†ËΩΩ‰æõÂ∫îÂïÜÂàóË°®Â§±Ë¥•');
                        }
                    } catch (error) {
                        console.error('Âä†ËΩΩ‰æõÂ∫îÂïÜÂ§±Ë¥•:', error);
                        ElMessage.error('Âä†ËΩΩ‰æõÂ∫îÂïÜÂàóË°®Â§±Ë¥•: ' + error.message);
                    } finally {
                        this.loading = false;
                    }
                },
                getProviderTypeLabel(type) {
                    const labels = {
                        'gemini': 'Gemini',
                        'openai_style': 'OpenAI'
                    };
                    return labels[type] || type;
                },
                showAddDialog() {
                    this.dialogMode = 'add';
                    this.currentProvider = this.getEmptyProvider();
                    this.customKeywordsText = '';
                    this.dialogVisible = true;
                },
                showEditDialog(provider, index) {
                    this.dialogMode = 'edit';
                    this.currentIndex = index;
                    this.currentProvider = JSON.parse(JSON.stringify(provider));

                    if (!this.currentProvider.custom_keywords) {
                        this.currentProvider.custom_keywords = [];
                    }

                    this.customKeywordsText = this.currentProvider.custom_keywords.join('\n');
                    this.dialogVisible = true;
                },
                copyProvider(provider) {
                    this.dialogMode = 'add';
                    this.currentProvider = JSON.parse(JSON.stringify(provider));
                    this.currentProvider.name = provider.name + '_copy';
                    this.customKeywordsText = (this.currentProvider.custom_keywords || []).join('\n');
                    this.dialogVisible = true;
                    ElMessage.success('Â∑≤Â§çÂà∂‰æõÂ∫îÂïÜÈÖçÁΩÆÔºåËØ∑‰øÆÊîπÂêçÁß∞Âêé‰øùÂ≠ò');
                },
                async saveProvider() {
                    if (!this.currentProvider.name) {
                        ElMessage.error('ËØ∑ËæìÂÖ•‰æõÂ∫îÂïÜÂêçÁß∞');
                        return;
                    }
                    if (!this.currentProvider.check_model) {
                        ElMessage.error('ËØ∑ËæìÂÖ•Ê£ÄÊü•Ê®°Âûã');
                        return;
                    }
                    if (!this.currentProvider.key_patterns || !this.currentProvider.key_patterns[0]) {
                        ElMessage.error('ËØ∑ËæìÂÖ•ÂØÜÈí•Ê≠£ÂàôË°®ËææÂºè');
                        return;
                    }

                    this.currentProvider.custom_keywords = this.customKeywordsText
                        .split('\n')
                        .map(line => line.trim())
                        .filter(line => line.length > 0);

                    if (this.dialogMode === 'add') {
                        this.providers.push(this.currentProvider);
                    } else {
                        this.providers[this.currentIndex] = this.currentProvider;
                    }

                    await this.updateProviders();
                    this.dialogVisible = false;
                },
                deleteProvider(index) {
                    ElMessageBox.confirm(
                        'Á°ÆÂÆöË¶ÅÂà†Èô§ËØ•‰æõÂ∫îÂïÜÂêóÔºüÂà†Èô§ÂêéÊó†Ê≥ïÊÅ¢Â§ç„ÄÇ',
                        'Á°ÆËÆ§Âà†Èô§',
                        {
                            confirmButtonText: 'Á°ÆÂÆöÂà†Èô§',
                            cancelButtonText: 'ÂèñÊ∂à',
                            type: 'warning',
                            buttonSize: 'large'
                        }
                    ).then(async () => {
                        this.providers.splice(index, 1);
                        await this.updateProviders();
                        ElMessage.success('Âà†Èô§ÊàêÂäü');
                    }).catch(() => {});
                },
                async updateProviders() {
                    this.loading = true;
                    try {
                        const token = localStorage.getItem('access_token');
                        const response = await fetch('/api/config/ai_providers', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify(this.providers)
                        });

                        if (response.ok) {
                            ElMessage.success('‰øùÂ≠òÊàêÂäü');
                            await this.loadProviders();
                        } else {
                            const error = await response.json();
                            ElMessage.error('‰øùÂ≠òÂ§±Ë¥•: ' + (error.detail || 'Êú™Áü•ÈîôËØØ'));
                        }
                    } catch (error) {
                        ElMessage.error('‰øùÂ≠òÂ§±Ë¥•: ' + error.message);
                    } finally {
                        this.loading = false;
                    }
                },
                resetDialog() {
                    this.currentProvider = this.getEmptyProvider();
                    this.currentIndex = -1;
                    this.customKeywordsText = '';
                },
                viewKeywords(provider) {
                    this.selectedProvider = provider;
                    this.presetKeywords = this.generatePresetKeywords(provider);
                    this.keywordsDialogVisible = true;
                },
                generatePresetKeywords(provider) {
                    const keywords = [];
                    const providerName = provider.name.toUpperCase();
                    const patterns = provider.key_patterns || [];

                    patterns.forEach(pattern => {
                        const match = pattern.match(/^([A-Za-z0-9\-_]{3,10})/);
                        if (match) {
                            const prefix = match[1];
                            const languages = ['python', 'javascript', 'typescript', 'go'];
                            languages.forEach(lang => {
                                keywords.push(`"${providerName}_API_KEY" = "${prefix}" language:${lang}`);
                            });
                        }
                    });

                    return keywords;
                },
                showPatternHelp() {
                    ElMessageBox.alert(
                        'Â∏∏Áî®ÂØÜÈí•Ê®°ÂºèÁ§∫‰æã:\n\n' +
                        'Gemini: AIzaSy[A-Za-z0-9\\\\-_]{33}\n' +
                        'OpenAI: sk-[A-Za-z0-9]{20,}\n' +
                        'OpenRouter: sk-or-v1-[A-Za-z0-9]{64}\n' +
                        'Cerebras: csk-[A-Za-z0-9]+\n\n' +
                        'Ê≥®ÊÑèÔºöÊ≠£ÂàôË°®ËææÂºè‰∏≠ÁöÑÂèçÊñúÊù†ÈúÄË¶ÅËΩ¨‰πâÔºàÁî®Âõõ‰∏™ÂèçÊñúÊù†Ôºâ',
                        'ÂØÜÈí•Ê®°ÂºèÂ∏ÆÂä©',
                        {
                            confirmButtonText: 'Áü•ÈÅì‰∫Ü',
                            buttonSize: 'large'
                        }
                    );
                }
            },
            components: {
                'nav-bar': NavBar
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>
